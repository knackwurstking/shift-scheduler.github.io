var L=Object.defineProperty;var k=(n,e,t)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>k(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();class w{constructor(){this.listeners={}}addListener(e,t){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(s=>s!==t))}dispatch(e,t){this.listeners[e]&&this.listeners[e].forEach(s=>s(t))}}class ${constructor(e){this.prefix="",this.events=new w,this.data={},this.prefix=e}delete(e,t){t!=null&&t.skipStore||localStorage.removeItem(`${this.prefix}${e}`),delete this.data[e]}get(e,t){if(!(t!=null&&t.skipStore)){const s=localStorage.getItem(`${this.prefix}${e}`);if(s!==null)return JSON.parse(s)}if(this.data.hasOwnProperty(e))return this.data[e]}set(e,t,s=!1,r){if(s){let o=null;r!=null&&r.skipStore?o=null:o=localStorage.getItem(`${this.prefix}${e}`),o!==null?this.data[e]=JSON.parse(o):this.data.hasOwnProperty(e)||(this.data[e]=t)}else this.data[e]=t;r!=null&&r.skipStore||localStorage.setItem(`${this.prefix}${e}`,JSON.stringify(this.data[e])),this.events.dispatch(e,this.data[e])}update(e,t,s){const r=this.get(e,s);if(r===void 0)throw new Error(`"${e}" not found, use \`set\``);this.set(e,t(r),!1,s)}listen(e,t,s=!1,r){if(s){const o=this.get(e,r);o!==void 0&&setTimeout(()=>t(o))}return this.events.addListener(e,t)}}function X(n,e){let t=null;async function s(r){var o,i;if(t!==null&&(((o=t.template)==null?void 0:o.onDestroy)!==void 0&&t.template.onDestroy(),t.onDestroy!==void 0&&t.onDestroy()),t=r,t.title!==void 0){const a=document.querySelector("head > title");a!==null&&(a.innerHTML=t.title)}if((t==null?void 0:t.href)!==void 0){const a=await(await fetch(t.href)).text();n.innerHTML=a,t.scripts!==void 0&&t.scripts.forEach(l=>{const h=document.createElement("script");h.setAttribute("data-template",t.href),h.src=l.src,n.appendChild(h)})}if((t==null?void 0:t.onMount)!==void 0&&t.onMount(),(t==null?void 0:t.template)!==void 0){let a=n;t.template.target!==void 0&&(a=document.querySelector(t.template.target));const l=document.querySelector(t.template.selector);if(l===null)throw`${t.template.selector} not found`;l instanceof HTMLTemplateElement?(a.innerHTML="",a.appendChild(l.content.cloneNode(!0))):a.innerHTML=l.innerHTML,((i=t.template)==null?void 0:i.onMount)!==void 0&&t.template.onMount()}}window.addEventListener("hashchange",()=>{const r=window.location.hash.replace("#","");let o="";for(const i of Object.keys(e))r.startsWith(i)&&i>o&&(o=i);if(!o){const i=e["/"];if(i===void 0){console.warn(`Window location “${r}” is missing in routes, and the fallback route “/“ is also missing.`);return}s(i);return}s(e[o])}),window.dispatchEvent(new Event("hashchange"))}function x(n,e){let t;if(n?t=`?${Object.entries(n).map(([s,r])=>`${encodeURIComponent(s)}=${encodeURIComponent(r)}`).join("&")}`:t="",!e&&!t){location.hash="";return}location.hash=`#${encodeURIComponent(e)}`+(t?`&${t}`:"")}function O(){const n={};return location.hash.replace(/^#.*\?/,"").split("?").forEach(e=>{e.split("&").forEach(t=>{const[s,r]=t.split("=");n[decodeURIComponent(s)]=decodeURIComponent(r)})}),n}const I=Object.freeze(Object.defineProperty({__proto__:null,getSearchParam:O,goTo:x,init:X},Symbol.toStringTag,{value:"Module"})),P=Object.freeze(Object.defineProperty({__proto__:null,hash:I},Symbol.toStringTag,{value:"Module"}));function S(){return M().innerText}function f(n){M().innerText=n}function M(){return document.querySelector(".ui-app-bar .center .title")}const N="shift-scheduler:",u=(()=>{const n=new $(N),e=new Date;return n.set("date-picker",new Date(e.getFullYear(),e.getMonth(),1).getTime(),!1),n.set("week-start",0,!0),n.set("settings",{shifts:[],rhythm:[],startDate:""},!0),n.set("edit-mode",{open:!1,active:null},!1),n})();async function B(n,e,t){const s=[],r=u.get("week-start");for(let o=0;o<n;o++){const i=new Date(e,t,o+1-H(e,t,r));s.push({year:i.getFullYear(),month:i.getMonth(),date:i.getDate(),shift:A(i),note:""})}return s}function H(n,e,t){const r=new Date(n,e,1).getDay();return t===0?r:r===0?6:r-1}function A(n){const e=u.get("settings");if(!e.startDate||!e.rhythm.length)return null;const t=new Date(e.startDate),s=Math.round((n.getTime()-t.getTime())/(1e3*60*60*24));return s<=0?e.shifts.find(r=>r.id===e.rhythm[e.rhythm.length+(s%e.rhythm.length||-e.rhythm.length)])||null:e.shifts.find(r=>r.id===e.rhythm[s%e.rhythm.length])||null}function C(n){return typeof n.id!="number"||typeof n.name!="string"||typeof n.shortName!="string"||typeof n.color!="string"&&n.color?!1:(n.color==="transparent"&&(n.visible=!1,n.color=null),typeof n.visible!="boolean"&&(n.visible=!0),n.color||(n.color=null),!0)}class F{constructor(e,t){c(this,"version");c(this,"name");c(this,"storeName","user");c(this,"request",null);this.name=e,this.version=t}open(e){this.request=window.indexedDB.open(this.name,this.version),this.request.onerror=this.onError.bind(this),this.request.onblocked=this.onBlocked.bind(this),this.request.onsuccess=()=>{e&&e()},this.request.onupgradeneeded=this.onUpgradeNeeded.bind(this)}close(){this.request!==null&&this.request.result.close()}validate(e,t){switch(e){case 0:case 1:return j(t);default:return!1}}get(e,t,s){return new Promise(r=>{const o=this.roStore().get([e,t,s]);o.onsuccess=()=>r(o.result||null),o.onerror=()=>r(null)})}getAll(){return new Promise(e=>{const t=this.roStore().getAll();t.onsuccess=()=>e(t.result),t.onerror=s=>{console.warn(`[DB] Error while getting all data from the store: "${this.storeName}"`,s),e([])}})}add(e){return new Promise((t,s)=>{const r=this.rwStore().add(e);r.onsuccess=()=>t(),r.onerror=async o=>{console.warn(`[DB] Error while adding "${e.year}-${e.month}-${e.date}" to "${this.storeName}"!`,o),s(r.error)}})}put(e){return new Promise((t,s)=>{const r=this.rwStore().put(e);r.onsuccess=()=>t(),r.onerror=async o=>{console.warn(`[DB] Error while putting "${e.year}-${e.month}-${e.date}" to "${this.storeName}"!`,o),s(r.error)}})}delete(e,t,s){return new Promise((r,o)=>{const i=this.rwStore().delete([e,t,s]);i.onsuccess=()=>r(),i.onerror=()=>{o(i.error)}})}deleteAll(){return new Promise((e,t)=>{const s=this.rwStore().clear();s.onsuccess=()=>e(),s.onerror=()=>{t(s.error)}})}roStore(){if(this.request===null)throw"request is null, run open first!";return this.request.result.transaction(this.storeName,"readonly").objectStore(this.storeName)}rwStore(){if(this.request===null)throw"request is null, run open first!";return this.request.result.transaction(this.storeName,"readwrite").objectStore(this.storeName)}createStore(e){if(!e.objectStoreNames.contains(this.storeName)){const t=e.createObjectStore(this.storeName,{autoIncrement:!1,keyPath:["year","month","date"]});t.createIndex("year","year",{unique:!1}),t.createIndex("month","month",{unique:!1}),t.createIndex("date","date",{unique:!1}),t.createIndex("note","note",{unique:!1}),t.createIndex("shift","shift",{unique:!1})}}onError(e){var t;console.error(`[DBCustom] Handle request failed: ${this.name}`,{error:((t=this.request)==null?void 0:t.error)||null,event:e}),alert(`[DBCustom] Handle request failed: ${this.name} (see console)`)}onBlocked(e){var t;console.warn(`[DBCustom] Handle request blocked: ${this.name}`,{error:((t=this.request)==null?void 0:t.error)||null,event:e}),alert(`[DBCustom] Handle request blocked: ${this.name} (see console)`)}onUpgradeNeeded(e){switch(e.oldVersion){case 0:if(this.request===null)throw"request is null, run open first!";this.createStore(this.request.result);break}}}function j(n){return!(typeof n.year!="number"||typeof n.month!="number"||typeof n.date!="number"||(typeof n.note!="string"&&(n.note=""),n.shift!==null&&!C(n.shift)))}const T=new F("shift-scheduler",1),m={datePicker:{dialog:'dialog[name="date-picker"]',form:'dialog[name="date-picker"] form',inputs:{month:'dialog[name="date-picker"] form input[type="month"]'}}};function Y(n){return new Promise(e=>{const t=document.querySelector(m.datePicker.dialog),s=document.querySelector(m.datePicker.inputs.month);switch(typeof n){case"string":n=new Date(n);break;case"number":n=new Date(n);break}s.value=`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}`;let r=null;const o=document.querySelector(m.datePicker.form);o.onsubmit=()=>{r={date:new Date(s.value).getTime()}},t.onclose=()=>e(r),t.showModal()})}const _=String.raw,R=[0,1,2,3,4,5,6],U=["Sun","Mon","Tue","Wed","Thy","Fri","Sat"];function W(n,e){const t=document.querySelector('template[name="calendar-item-content"]').content.cloneNode(!0),s=t.querySelector(".item-content");for(let r=0;r<6;r++){const o=document.createElement("div");s.appendChild(o),o.className="days ui-flex-grid-item ui-flex-grid-row",o.style.setProperty("--gap","0.05rem");for(let i=0;i<7;i++)o.append(z(0))}return setTimeout(()=>{b(s,n,e)}),t}async function b(n,e,t){const s=new Date(e,t),r=u.get("settings"),o=Array.from(n.querySelectorAll(".item-content > .days > .day"));(await B(o.length,s.getFullYear(),s.getMonth())).forEach(async(a,l)=>{const h=await T.get(a.year,a.month,a.date);if(h!==null){a.note=h.note;const p=r.shifts.find(D=>{var g;return D.id===((g=h.shift)==null?void 0:g.id)});p?a.shift=p:a.shift=h.shift||a.shift}V(o[l],a),t!==a.month?o[l].setAttribute("disabled",""):o[l].removeAttribute("disabled"),a.year!==s.getFullYear()||a.month!==s.getMonth()?o[l].classList.add("inactive"):o[l].classList.remove("inactive")}),J([...n.querySelectorAll(".item-content > .week-days > .week-day")],o)}function J(n,e){const t=u.get("week-start");let s=R;t>0&&(s=[...s.slice(t),...s.slice(0,t)]);const r=s.findIndex(i=>i===6),o=s.findIndex(i=>i===0);n.forEach((i,a)=>{i.innerHTML=`${U[s[a%7]]}`}),[...n,...e].forEach((i,a)=>{i.classList.remove("saturday"),i.classList.remove("sunday"),a%s.length===r&&i.classList.add("saturday"),a%s.length===o&&i.classList.add("sunday")})}function z(n,e){const t=document.createElement("div");return t.className="day ui-flex-grid-item",t.innerHTML=_`
        <div class="date">${n}</div>
        <div class="shift">${""}</div>
    `,t}function V(n,e){((r,o,i)=>{const a=new Date;return a.getFullYear()===r&&a.getMonth()===o&&a.getDate()===i})(e.year,e.month,e.date)?n.classList.add("today"):n.classList.remove("today"),e.note?n.classList.add("note"):n.classList.remove("note"),n.querySelector(".date").innerHTML=`${e.date}`;const s=n.querySelector(".shift");e.shift?(s.style.setProperty("--shift-color",e.shift.visible?e.shift.color||"inherit":"transparent"),s.innerHTML=e.shift.shortName||""):(s.style.removeProperty("--shift-color"),s.innerHTML=""),n.setAttribute("data-year",e.year.toString()),n.setAttribute("data-month",e.month.toString()),n.setAttribute("data-date",e.date.toString())}async function K(n){const e=new Date(n);e.setMonth(e.getMonth()-1),Array.from(document.querySelector(".item-container").children).forEach(async t=>{b(t.querySelector(".item-content"),e.getFullYear(),e.getMonth()),e.setMonth(e.getMonth()+1)})}async function G(n){}async function y(n){switch(n){case"left":u.update("date-picker",e=>{const t=new Date(e);return t.setMonth(t.getMonth()+1),t.getTime()});break;case"right":u.update("date-picker",e=>{const t=new Date(e);return t.setMonth(t.getMonth()-1),t.getTime()});break}}const Q=75;class Z extends w{constructor(t){super();c(this,"container");c(this,"finalTransform",!1);c(this,"startX",null);c(this,"clientX",null);c(this,"onMouseMove");c(this,"onTouchMove");c(this,"onMouseOrTouchEnd");c(this,"onTouchCancel");c(this,"animationFrameHandler");this.container=t}start(){this.onMouseMove=async t=>{this.finalTransform||t.buttons===1&&(this.startX===null&&(this.startX=t.clientX,this.containerItems().forEach(s=>s.classList.add("moving"))),this.clientX=t.clientX)},this.onTouchMove=async t=>{this.finalTransform||(this.startX===null&&(this.startX=t.touches[0].clientX,this.containerItems().forEach(s=>s.classList.add("moving"))),this.clientX=t.touches[0].clientX)},this.onMouseOrTouchEnd=async t=>{if(this.startX===null||this.clientX===null||this.finalTransform)return;if(this.finalTransform=!0,!this.isMinSwipe()){this.setTransition(`left ${.15}s ease`),this.moveX(0),setTimeout(()=>this.resetSwipe(),150);return}const s=t.currentTarget.getBoundingClientRect();this.setTransition(`left ${.3}s ease`),this.moveX(this.clientX>this.startX?+(s.width+1):-s.width+1),setTimeout(()=>this.resetSwipe(),300)},this.onTouchCancel=async t=>{this.startX!==null&&await this.onMouseOrTouchEnd(t)},this.animationFrameHandler=async()=>{if(this.finalTransform||this.startX===null||this.clientX===null){requestAnimationFrame(this.animationFrameHandler);return}this.moveX(this.clientX-this.startX),requestAnimationFrame(this.animationFrameHandler)},this.container.addEventListener("mousemove",this.onMouseMove,{passive:!0}),this.container.addEventListener("mouseup",this.onMouseOrTouchEnd),this.container.addEventListener("mouseout",this.onMouseOrTouchEnd),this.container.addEventListener("touchmove",this.onTouchMove,{passive:!0}),this.container.addEventListener("touchend",this.onMouseOrTouchEnd),this.container.addEventListener("touchcancel",this.onTouchCancel),requestAnimationFrame(this.animationFrameHandler)}stop(){this.onMouseMove&&this.container.removeEventListener("mousemove",this.onMouseMove),this.onMouseOrTouchEnd&&(this.container.removeEventListener("mouseup",this.onMouseOrTouchEnd),this.container.removeEventListener("mouseout",this.onMouseOrTouchEnd),this.container.removeEventListener("touchend",this.onMouseOrTouchEnd)),this.onTouchMove&&this.container.removeEventListener("touchmove",this.onTouchMove),this.onTouchCancel&&this.container.removeEventListener("touchcancel",this.onTouchCancel)}containerItems(){return Array.from(this.container.children)}isMinSwipe(){return this.startX===null||this.clientX===null?!1:Math.abs(this.startX-this.clientX)>Q*(window.innerWidth/1080)}moveX(t){const s=this.containerItems();s[0].style.left=`calc(-100% + ${t}px)`,s[1].style.left=`calc(0% + ${t}px)`,s[2].style.left=`calc(100% + ${t}px)`}setTransition(t){this.containerItems().forEach(r=>r.style.transition=t)}resetSwipe(){this.setTransition("none"),this.isMinSwipe()&&this.reorderItems(),this.startX=null,this.clientX=null,this.finalTransform=!1,this.containerItems().forEach(t=>t.classList.remove("moving"))}reorderItems(){if(this.startX===null||this.clientX===null)return;const t=this.containerItems(),s=this.clientX>this.startX?"right":"left";switch(s){case"left":this.container.appendChild(this.container.removeChild(t[0]));break;case"right":this.container.insertBefore(this.container.removeChild(t[2]),t[0]);break}this.moveX(0),this.dispatch("swipe",s)}}let q="",d=[];async function ee(){q=S(),f("");const n=new Z(document.querySelector(".item-container"));se(),ne(),re(),setTimeout(()=>{n.start()}),n.addListener("swipe",y),d.push(()=>{n.removeListener("swipe",y),n.stop()})}async function te(){f(q),d.forEach(n=>n()),d=[]}function ne(){const n=new Date;Array.from(document.querySelector(".item-container").children).forEach(e=>{e.innerHTML="",e.appendChild(W(n.getFullYear(),n.getMonth()))})}function se(){const n=document.querySelector(".ui-app-bar .left button.date-picker"),e=document.querySelector(".ui-app-bar .right button.today"),t=document.querySelector(".ui-app-bar .right button.edit"),s=document.querySelector(".ui-app-bar .right button.printer"),r=document.querySelector(".ui-app-bar .right button.settings");n.style.display="inline-flex",e.style.display="inline-flex",t.style.display="inline-flex",s.style.display="inline-flex",r.style.display="inline-flex",n.onclick=async()=>{const o=await Y(u.get("date-picker"));o&&u.set("date-picker",o.date)},e.onclick=async()=>{u.set("date-picker",new Date().getTime())},d.push(u.listen("date-picker",o=>{const i=new Date,a=new Date(o),l=a.getFullYear();l===i.getFullYear()&&a.getMonth()===i.getMonth()?e.setAttribute("disabled",""):e.removeAttribute("disabled");const h=(a.getMonth()+1).toString().padStart(2,"0");n.innerText=`${l} / ${h}`},!0)),d.push(()=>{n.style.display="none",e.style.display="none",t.style.display="none",s.style.display="none",r.style.display="none"})}function re(){d.push(u.listen("date-picker",K,!0),u.listen("edit-mode",G,!0))}let E="",v=[];async function oe(){E=S(),f("")}async function ie(){f(E),v.forEach(n=>n()),v=[]}T.open(()=>{P.hash.init(document.querySelector("#routerTarget"),{"/":{title:"Shift Scheduler",template:{selector:'template[name="calendar"]',onMount(){ee()},onDestroy(){te()}}},settings:{title:"Shift Scheduler | Settings",template:{selector:'template[name="settings"]',onMount(){oe()},onDestroy(){ie()}}}})});
